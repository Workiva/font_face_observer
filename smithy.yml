project: static
language: dart

runner_image: drydock-prod.workiva.org/workiva/smithy-runner-dart:91483

env:
  - CODECOV_TOKEN='bQ4MgjJ0G2Y73v8JNX6L7yMK9679nbYB'

script:
  - pub get
  - pub run dart_dev analyze
  - pub run dart_dev format --check
  - xvfb-run -s '-screen 0 1024x768x24' pub run dart_dev test -p content-shell
  - xvfb-run -s '-screen 0 1024x768x24' pub run dart_dev coverage --no-html

  # Create docs
  - pub run dart_dev docs --no-open
  - tar czvf api.tar.gz -C doc/api .

  # Build assets to push to the CDN
  - pub build
  - ./tool/stage_for_cdn.sh

  # Package up static assets for functional testing
  - tar -hcf build.tar.gz build/web/

  # Tar up lib for pushing to the pub repository
  - tar czvf font_face_observer.pub.tgz LICENSE README.md pubspec.yaml lib/

after_script:
  - ./tool/codecov.sh

artifacts:
  web_build:
    - ./build.tar.gz
  pub:
    - ./font_face_observer.pub.tgz
  dart-dependencies: # For RM dependency tracking
    - ./pubspec.lock
  documentation:
    - api.tar.gz
